{% extends 'main/base.html' %}

{% block title %}Tournament{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mt-4">Tournament: {{ tournament.name }}</h1>
    {% if final_match %}
    <h2 class="mt-3">The Winner of the Tournament is: {{ tournament.winner.user.first_nmae }}</h2>
    {% endif %}

    <div class="row mt-4">
        {% for tournament in tournaments %}
        <div class="col-md-6">
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title">{{ tournament.name }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">ID: {{ tournament.id }}</h6>
                    {% if tournament.winner %}
                    <h6>we have winner : {{ tournament.winner.user.username }}</h6>
                    {% endif %}
                    <h6>Players:</h6>
                    <ul class="list-group">
                        {% for player in tournament.tournamentplayers_set.all %}
                        <li class="list-group-item">{{ player.player.user.first_name }}</li>
                        {% endfor %}
                    </ul>
                    {% if tournament.number_of_players != 0 %}
                    <a href="{% url 'tournament:enroll_view' tournament.id %}" class="btn btn-primary mt-2">Enroll</a>
                    {% else %}
                    <p class="btn btn-primary mt-2">Full</p>
                    {% endif %}
                    <a href="{% url 'tournament:tournament_controll' tournament.id %}" class="btn btn-secondary mt-2">Controll</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% if matches %}
    <h2 class="mt-4">Matches</h2>
    <ol class="list-group">
        {% for match in matches %}
        <li class="list-group-item">
            <p>Round: {{ match.in_round }}</p>
            <p>Match: {{ match.player1.user.username }} vs. {{ match.player2.user.username }}</p>
            {% if not match.winner %}
            <form method="post" action="{% url 'tournament:select_winner' match.id %}">
                {% csrf_token %}
                <div class="form-group">
                    <label for="winner">Select Winner:</label>
                    <select class="form-control" name="winner">
                        <option value="{{ match.player1.user.id }}">{{ match.player1.user.username }}</option>
                        <option value="{{ match.player2.user.id }}">{{ match.player2.user.username }}</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">Submit Winner</button>
            </form>
            {% else %}
            <p>Winner: {{ match.winner.user.username }}</p>
            {% endif %}
        </li>
        {% endfor %}
        {% if tournament.winner %}
        <h2>Winner of this tournament : {{ tournament.winner.user.first_name }}</h2>
        {% endif %}
    </ol>
    {% else %}
    <p>No matches available.</p>
    {% if request.user.profile.states == '2' %}
    <a href="{% url 'tournament:create_tournament' %}" class="btn btn-primary">Create Tournament</a>
    {% endif %}
    {% endif %}
</div>
{% endblock %}
